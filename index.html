<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>2026 å°¾ç‰™è³½é¦¬ - è·å ´ç´”äº«ç‰ˆ</title>
    <style>
        :root { --primary: #d32f2f; --gold: #ffd700; --track-bg: #2c3e50; --success: #4caf50; --warning: #ffeb3b; --danger: #ff5252; --recover: #00bcd4; --sprint: #ff5722; }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: #121212; color: white; margin: 0; padding: 10px; height: 100vh; display: flex; flex-direction: column; align-items: center; overflow: hidden; }
        
        /* é¸é¦¬ç•«é¢ */
        .setup-area { background: #1e1e1e; padding: 20px; border-radius: 20px; width: 95vw; max-width: 1200px; border: 1px solid #444; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 100; }
        .horse-select-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-top: 15px; }
        .horse-slot { background: linear-gradient(145deg, #252525, #1a1a1a); padding: 15px; border-radius: 12px; border: 2px solid #333; cursor: pointer; transition: 0.3s; position: relative; overflow: hidden; }
        .horse-slot:hover { border-color: var(--gold); transform: translateY(-5px); }
        .horse-slot.selected { opacity: 0.15; filter: grayscale(1); pointer-events: none; }
        
        .trait-tag { font-size: 10px; background: var(--primary); color: white; padding: 2px 6px; border-radius: 4px; position: absolute; top: 10px; right: 10px; }
        .stat-group { margin-top: 10px; }
        .stat-row { display: flex; align-items: center; margin-top: 5px; font-size: 11px; }
        .stat-label { width: 45px; color: #888; }
        .stat-bar { flex-grow: 1; height: 6px; background: #000; border-radius: 3px; overflow: hidden; border: 1px solid #333; }
        .stat-fill { height: 100%; background: linear-gradient(90deg, #444, var(--gold)); }
        .horse-desc { font-size: 11px; color: #aaa; margin-top: 10px; line-height: 1.4; font-style: italic; }

        /* è³½é“å€ï¼šç¨å¾®ä¸Šç§»ï¼Œå› ç‚ºæ²’æœ‰è¨ˆæ™‚å™¨äº† */
        .track-container { position: relative; width: 98vw; flex-grow: 1; background: var(--track-bg); border: 4px solid #333; border-radius: 10px; display: none; margin-top: 20px; overflow: hidden; padding-top: 40px; }
        .finish-line { position: absolute; right: 80px; top: 0; bottom: 0; width: 30px; background: repeating-linear-gradient(0deg, #fff, #fff 15px, #000 15px, #000 30px); border-left: 4px solid var(--gold); z-index: 1; }
        .lane { position: relative; height: 9.8%; border-bottom: 1px dashed rgba(255,255,255,0.05); display: flex; align-items: center; }
        
        .horse-container { position: absolute; left: 10px; z-index: 10; display: flex; align-items: center; width: 130px; transition: left 0.3s cubic-bezier(0.1, 0.7, 0.1, 1); }
        .horse-icon { font-size: 32px; transform: scaleX(-1); margin-right: 5px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
        
        .stamina-mini { width: 50px; height: 5px; background: #000; margin-top: 3px; border-radius: 2px; }
        .stamina-mini-fill { height: 100%; background: var(--success); transition: width 0.3s; }
        
        .status-bubble { position: absolute; top: -42px; left: 0; font-size: 12px; padding: 4px 12px; border-radius: 12px; display: none; z-index: 100; font-weight: bold; color: white; border: 2px solid white; white-space: nowrap; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        #start-btn { padding: 18px 80px; font-size: 26px; background: linear-gradient(135deg, var(--primary), #8e0000); color: white; border: none; border-radius: 50px; cursor: pointer; margin: 30px; display: none; font-weight: bold; }
        #leaderboard { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; background: white; color: #111; border-radius: 20px; padding: 25px; z-index: 200; display: none; border: 5px solid var(--gold); }
    </style>
</head>
<body>

    <h2 id="main-title" style="margin: 10px; color: var(--gold); letter-spacing: 4px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">ğŸ’¼ 2026 å°¾ç‰™è³½é¦¬ï¼šè·å ´é¦¬æ‹‰æ¾</h2>

    <div id="setup" class="setup-area">
        <h3 id="picker-title" style="margin:0; text-align: center; font-size: 20px; color: #fff;">è«‹é¸æ“‡è§’è‰²</h3>
        <div class="horse-select-grid" id="select-grid"></div>
    </div>

    <button id="start-btn">ğŸ é–‹è³½ï¼</button>

    <div class="track-container" id="track">
        <div class="finish-line"></div>
        <div id="lanes-box" style="height: 100%;"></div>
    </div>

    <div id="leaderboard">
        <h2 style="text-align:center; color: var(--primary); margin: 0; font-size: 32px;">ğŸ† FINAL RANK ğŸ†</h2>
        <div id="leaderboard-list" style="margin-top: 20px;"></div>
        <button onclick="location.reload()" style="width:100%; padding:15px; margin-top:20px; background: #1a1a1a; color: white; border-radius: 10px; cursor:pointer; font-weight: bold;">å†è·‘ä¸€æ¬¡</button>
    </div>

<script>
    const horseLibrary = [
        { id: 0, trait: "è–ªæ°´å°å·", stats: {spd: 60, sta: 95, burst: 40}, desc: "æ‡‚å¾—åœ¨å·¥ä½œä¸­æ‘¸é­šç¯€çœé«”åŠ›ï¼Œç©©å®šæ€§æœ€é«˜ã€‚"},
        { id: 1, trait: "ä¸‹ç­æˆ°ç¥", stats: {spd: 50, sta: 65, burst: 95}, desc: "ä¸­å¾Œæ®µç™¼åŠ›ï¼Œä¸€æ—¦çœ‹åˆ°çµ‚é»ç·šæœƒç˜‹ç‹‚åŠ é€Ÿã€‚"},
        { id: 2, trait: "å ±å¸³æ€¥å…ˆé‹’", stats: {spd: 95, sta: 25, burst: 80}, desc: "èµ·æ­¥è¶…å¿«ï¼Œä½†å¦‚æœä¸ä¼‘æ¯çµ•å°æœƒçˆ†è‚ã€‚"},
        { id: 3, trait: "æœƒè­°ç™¼è¨€æ©Ÿ", stats: {spd: 75, sta: 60, burst: 60}, desc: "å„é …æ•¸å€¼å¹³å‡ï¼Œé©åˆç©©æ‰“ç©©ç´®çš„ç©å®¶ã€‚"},
        { id: 4, trait: "å’–å•¡ä¸­æ¯’è€…", stats: {spd: 80, sta: 45, burst: 75}, desc: "ä¾è³´å’–å•¡å› ï¼ˆéš¨æ©Ÿè¡åˆºï¼‰ï¼Œé«”åŠ›æ³¢å‹•å¤§ã€‚"},
        { id: 5, trait: "ç”©é‹å°ˆæ¥­æˆ¶", stats: {spd: 45, sta: 85, burst: 30}, desc: "é‹æ°£å‹é¦¬åŒ¹ï¼Œèƒ½å®Œå…¨å…ç–«æ»‘å€’äº‹ä»¶ã€‚"},
        { id: 6, trait: "åŠ ç­é‚Šç·£äºº", stats: {spd: 55, sta: 90, burst: 50}, desc: "å­˜åœ¨æ„Ÿä½ä½†è€åŠ›åè¶³ï¼Œé»˜é»˜çˆ¬ä¸Šé¦–ä½ã€‚"},
        { id: 7, trait: "è€é—†è¦ªä¿¡", stats: {spd: 35, sta: 70, burst: 99}, desc: "éš±è—ç‹è€…ï¼Œé›–ç„¶æ…¢ä½†æ¥µæ˜“è§¸ç™¼ç¥ç´šè¡åˆºã€‚"},
        { id: 8, trait: "PM å‚¬ç¨¿å“¡", stats: {spd: 85, sta: 50, burst: 70}, desc: "é«˜æ•ˆç‡ä»£è¡¨ï¼Œæœƒä¸€ç›´çµ¦èº«é‚Šçš„äººå£“åŠ›ã€‚"},
        { id: 9, trait: "Excel é­”æ³•å¸«", stats: {spd: 70, sta: 75, burst: 65}, desc: "æ•¸æ“šå¹³è¡¡ä¹‹ç‹ï¼Œé«”åŠ›åˆ†é…éå¸¸ç§‘å­¸ã€‚"}
    ];

    let names = ["JULIA", "MOLLY", "DON", "è±ªå“¥", "Gimme", "Erick", "éŸ‹å¿—", "JULI", "JASON", "KRIS"];
    let currentNameIndex = 0, selectedAssignments = [], finishedHorses = [];
    const colors = ["#FF5252", "#FFD700", "#E040FB", "#00E676", "#2979FF", "#FF9100", "#40C4FF", "#FF1744", "#F4FF81", "#B2FF59"];

    function initSetup() {
        const grid = document.getElementById('select-grid');
        document.getElementById('picker-title').innerText = `è«‹ ã€${names[0]}ã€‘ æŒ‘é¸è§’è‰²`;
        horseLibrary.forEach((h, i) => {
            const div = document.createElement('div');
            div.className = 'horse-slot';
            div.id = `slot-${i}`;
            div.innerHTML = `
                <div class="trait-tag">STAFF-${i+1}</div>
                <div style="font-size:28px; transform: scaleX(-1);">ğŸ</div>
                <b style="color:var(--gold); font-size:16px;">${h.trait}</b>
                <div class="stat-group">
                    <div class="stat-row"><span class="stat-label">æ•ˆç‡</span><div class="stat-bar"><div class="stat-fill" style="width:${h.stats.spd}%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">é«”åŠ›</span><div class="stat-bar"><div class="stat-fill" style="width:${h.stats.sta}%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">çˆ†ç™¼</span><div class="stat-bar"><div class="stat-fill" style="width:${h.stats.burst}%"></div></div></div>
                </div>
                <div class="horse-desc">${h.desc}</div>
            `;
            div.onclick = () => selectHorse(i);
            grid.appendChild(div);
        });
    }

    function selectHorse(idx) {
        if (document.getElementById(`slot-${idx}`).classList.contains('selected')) return;
        selectedAssignments.push({ name: names[currentNameIndex], horseData: horseLibrary[idx] });
        document.getElementById(`slot-${idx}`).classList.add('selected');
        currentNameIndex++;
        if (currentNameIndex < names.length) {
            document.getElementById('picker-title').innerText = `è«‹ ã€${names[currentNameIndex]}ã€‘ æŒ‘é¸è§’è‰²`;
        } else {
            document.getElementById('setup').style.display = 'none';
            document.getElementById('start-btn').style.display = 'block';
            prepareTrack();
        }
    }

    function prepareTrack() {
        const lanesBox = document.getElementById('lanes-box');
        document.getElementById('track').style.display = 'block';
        selectedAssignments.forEach((item, idx) => {
            const lane = document.createElement('div');
            lane.className = 'lane';
            lane.innerHTML = `<div class="horse-container" id="horse-${item.horseData.id}"><div class="status-bubble" id="status-${item.horseData.id}"></div><div class="horse-icon" style="color:${colors[idx]}">ğŸ</div><div class="horse-info-mini"><div class="horse-label" style="font-size:12px;">${item.name}</div><div class="stamina-mini"><div class="stamina-mini-fill" id="stamina-fill-${item.horseData.id}"></div></div></div></div>`;
            lanesBox.appendChild(lane);
        });
    }

    function updateBubble(id, text, color, display = true) {
        const el = document.getElementById(`status-${id}`);
        if (!el) return;
        if (!display) { el.style.display = 'none'; return; }
        el.innerText = text; el.style.display = 'block'; el.style.background = color;
    }

    document.getElementById('start-btn').onclick = function() {
        this.style.display = 'none';
        startRace();
    };

    function startRace() {
        const horses = selectedAssignments.map(item => ({ 
            ...item.horseData, ownerName: item.name, 
            pos: 10, speed: 0, currStamina: 100, 
            lastEventTime: Date.now() + (Math.random() * 2000),
            nextCooldown: 4000 + (Math.random() * 4000),
            finished: false, isStalled: false, isBursting: false 
        }));
        
        const finishLinePos = document.getElementById('track').offsetWidth - 130; 
        const raceStart = Date.now();

        const raceInterval = setInterval(() => {
            const raceElapsed = (Date.now() - raceStart) / 1000;

            horses.forEach(h => {
                if (h.finished) return;

                // æ¶ˆè€—é‚è¼¯
                if (!h.isStalled) {
                    let drainMult = h.id === 2 ? 1.8 : (h.id === 0 ? 0.45 : 1.0);
                    let staminaDrain = (h.speed * 0.06 + 0.12) * drainMult; 
                    h.currStamina = Math.max(0, h.currStamina - staminaDrain);
                }

                // çˆ†è‚å€’æ•¸
                if (h.currStamina <= 0 && !h.isStalled) {
                    h.speed = 0; h.isStalled = true; h.isBursting = false;
                    let count = 5;
                    const burnTimer = setInterval(() => {
                        updateBubble(h.id, `ğŸ¤® çˆ†è‚ä¸­...${count}`, "var(--danger)");
                        count--;
                        if (count < 0) {
                            clearInterval(burnTimer);
                            h.currStamina = 100; h.isStalled = false;
                            updateBubble(h.id, "", "", false);
                        }
                    }, 1000);
                }

                let isRedZone = h.currStamina < 20;
                let fatigueScale = isRedZone ? 0.4 : (h.currStamina < 50 ? 0.8 : 1.0);
                
                if (!h.isStalled) {
                    let accel = (Math.random() * 0.22);
                    
                    // ä¸‹ç­æˆ°ç¥çˆ†ç™¼ (ç´„ 20 ç§’å¾Œå•Ÿå‹•)
                    if (h.id === 1 && raceElapsed >= 15) { 
                        accel += 2.8; fatigueScale = 1.1; 
                        if (!h.isBursting) { h.isBursting = true; updateBubble(h.id, "ğŸ”¥ æ¥µé™è¡åˆºï¼", "var(--sprint)"); }
                    }

                    h.speed = ((h.speed * 0.93) + accel + (h.stats.spd * 0.002)) * fatigueScale;
                }

                // éš¨æ©Ÿäº‹ä»¶
                if (Date.now() - h.lastEventTime > h.nextCooldown && !h.finished && !h.isStalled) {
                    h.lastEventTime = Date.now();
                    h.nextCooldown = 4000 + (Math.random() * 4000);
                    const roll = Math.random();

                    if (roll < 0.12 && h.id !== 5) { 
                        // æ»‘å€’å¾Œé€€
                        h.speed = 0; h.pos = Math.max(10, h.pos - 40);
                        updateBubble(h.id, "â›¸ï¸ æ»‘å€’äº†ï¼", "#546e7a");
                        setTimeout(() => updateBubble(h.id, "", "", false), 1500);
                    } else if (roll < (isRedZone ? 0.4 : 0.2)) { 
                        // å·æ‡¶ zzzz...
                        h.speed = 0; h.isStalled = true; 
                        h.currStamina = Math.min(100, h.currStamina + 45); 
                        updateBubble(h.id, "ğŸ›Œ zzzz...", "var(--recover)");
                        setTimeout(() => { h.isStalled = false; updateBubble(h.id, "", "", false); }, 2000);
                    } else if (roll > 0.75 && !isRedZone) {
                        // âš¡ è¡åˆºï¼
                        h.isBursting = true;
                        updateBubble(h.id, "âš¡ è¡åˆºï¼", "var(--sprint)");
                        setTimeout(() => { h.isBursting = false; updateBubble(h.id, "", "", false); }, 2000);
                    }
                }

                h.pos += h.speed + (h.isBursting ? 0.9 : 0);
                const element = document.getElementById(`horse-${h.id}`);
                element.style.left = Math.min(h.pos, finishLinePos + 40) + 'px';
                
                const sFill = document.getElementById(`stamina-fill-${h.id}`);
                sFill.style.width = `${h.currStamina}%`;
                sFill.style.background = isRedZone ? 'var(--danger)' : (h.currStamina < 50 ? 'var(--warning)' : 'var(--success)');
                
                let rot = Math.sin(h.pos / 10) * (h.speed * 2);
                if (h.isBursting) rot *= 1.5;
                element.style.transform = `rotate(${rot}deg)`;

                if (h.pos >= finishLinePos && !h.finished) {
                    h.finished = true;
                    finishedHorses.push(h);
                    if (finishedHorses.length === 10) {
                        clearInterval(raceInterval);
                        setTimeout(showLeaderboard, 1000);
                    }
                }
            });
        }, 50);
    }

    function showLeaderboard() {
        document.getElementById('leaderboard').style.display = 'block';
        const list = document.getElementById('leaderboard-list');
        finishedHorses.forEach((h, i) => {
            const item = document.createElement('div');
            item.style.cssText = "padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; font-weight:bold;";
            item.innerHTML = `<span><span style="color:var(--primary)">#${i+1}</span> ${h.ownerName}</span> <span style="color:#666; font-size:12px;">${h.trait}</span>`;
            list.appendChild(item);
        });
    }
    initSetup();
</script>
</body>
</html>
